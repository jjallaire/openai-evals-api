## LLM Evaluation Frameworks

This document explores the capabilities of several existing LLM evaluation frameworks, with a particular eye towards their suitability as a platform for developing new evaluations. Frameworks covered include:

-   [OpenAI Evals](https://github.com/openai/evals)
-   [EleutherAI Eval Harness](https://github.com/EleutherAI/lm-evaluation-harness)
-   [Google BIG-bench](https://github.com/google/BIG-bench)
-   [CFRM Helm](https://crfm.stanford.edu/helm/latest/)

In order to explore various technical possibilities more concretely, this repo also includes some direct experimentation with the OpenAI evals package. This work is described in the repository [README](https://github.com/jjallaire/openai-evals-api#readme).

### Capabiliities

Broadly speaking, all of the frameworks provide the following:

-   Suite of evaluations that cover a diverse range of tasks, drawing problems from linguistics, childhood development, math, common-sense reasoning, biology, physics, social bias, software development, and beyond.
-   Command-line interface for running single evaluations or sets of evaluations and recording their results.
-   Extensibility mechanism for running evaluations against REST APIs or locally hosted language models.
-   Registry of evaluations (typically defined using YAML) that can be extended via pull request from external contributors.

Of particular interest here is not so much the base suite of evaluations, but rather the suitability of the underlying platform as a foundation for flexibly building, running, and recording new evaluations. Capabilities we are looking for include:

-   Ability to develop and run new evaluations without forking/modifying the original repository
-   Ability to add new model types without without forking/modifying the original repository
-   Ability to write highly custom evaluations using pure Python code (i.e. not just using pre-fab templates and patterns)
-   Mechanism to declare model graded evaluations (rather than text matching/similarity or multiple choice)
-   Mechnaism to define chained evaluation logic (e.g. wrapping arbitrary evaluations in a chain of thought prompt)
-   A means for evaluations to make multiple calls to LLMs and maintain state across the calls.
-   Flexible storage for evaluation results (e.g. store in an external database rather than in JSON files)
-   Well thought through standard schema and storage strategy for datasets used in evaluations.
-   User interface for browsing evaluation results
-   Ecosystem of third party tools (are others building on top of the framework)

### Comparison

In general, OpenAI and ElutherAI are designed and implemented more like general purpose evaluation platforms and Google and CFRM more like straightforward repositories of evaluations. This difference is reflected in the fact that with OpenAI and ElutherAI you can create new evaluations and model types in entirely different repositories, whereas with Google and CRFM you need to fork and modify the main repository. Note also that Google hasn't been updated since June 2023 so it's not entirely clear how actively maintained this effort it.

All of the frameworks provide some sort of data driven registration of evaluations as well as the ability to implement evaluations in pure Python (note however than ElutherAI may be in the process of deprecating custom `Task` classes). OpenAI further enables declaration of some more sophisticated evaluation methods, including model-graded evaluations, wrapped evaluations (e.g. wrapping an existing eval in a chain of thought prompt), and "solvers" that can generate a response in any way, call models and any number of times, wait for human input, or generate a response from a programmatic bot without any models involved. Note that all of the other frameworks could in theory do all the same things within pure Python evaluations, but if you wanted to use these capabilities across evals or use them from YAML/JSON declared evals you'd need to extend those frameworks accordingly.

There are various native and third party tools available for visualizing the results of evals. None however are particularly deep or sophisticated so it's likely that non-trivial use of these frameworks will require additional custom UI/visualization work.

Here's a high level summary of how the various frameworks compare on the capabilities enumerated in the previous section:

+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| Capability              | OpenAI Evals                                                                                                                                                                                                                                                                                                                                                                    | ElutherAI Harness                                                                                                                                                             | Google BIG-bench                                                                  | CFRM Helm                                                                          |
+=========================+=================================================================================================================================================================================================================================================================================================================================================================================+===============================================================================================================================================================================+===================================================================================+====================================================================================+
| External Evaluations    | Yes (`--registry-path)`                                                                                                                                                                                                                                                                                                                                                         | Yes (`--include-path_`                                                                                                                                                        | No                                                                                | No                                                                                 |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| External Model Types    | Yes (`CompletionFn`)                                                                                                                                                                                                                                                                                                                                                            | Yes, via `LM` class                                                                                                                                                           | No                                                                                | No                                                                                 |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| Pure Python Evaluations | Yes (`Eval`)                                                                                                                                                                                                                                                                                                                                                                    | Yes (`Task`) \                                                                                                                                                                | Yes (`Task`)                                                                      | Yes (`Scenario`)                                                                   |
|                         |                                                                                                                                                                                                                                                                                                                                                                                 | Deprecated?                                                                                                                                                                   |                                                                                   |                                                                                    |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| Declare Model Graded    | Yes, (`modelgraded`)                                                                                                                                                                                                                                                                                                                                                            | No                                                                                                                                                                            | No                                                                                | No                                                                                 |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| Declare Wrapped         | Yes (`completion_fns`)                                                                                                                                                                                                                                                                                                                                                          | No                                                                                                                                                                            | No                                                                                | No                                                                                 |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| Multiple Calls w/ State | Yes (`Solvers)`                                                                                                                                                                                                                                                                                                                                                                 | No                                                                                                                                                                            | No                                                                                | No                                                                                 |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| Custom Results Storage  | Yes (`Recorder`)                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                               |                                                                                   |                                                                                    |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| Datasets Format         | ls                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                               |                                                                                   |                                                                                    |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+
| UI / Third Party Tools  | [Weights & Biases](https://wandb.ai/wandb_fc/openai-evals/reports/OpenAI-Evals-Demo-Using-W-B-Prompts-to-Run-Evaluations--Vmlldzo0MTI4ODA3), [ChainForge](https://ianarawjo.medium.com/you-can-now-run-openai-evals-in-chainforge-81628446968d), [oaievals-collector](https://github.com/nstankov-bg/oaievals-collector), [zeno-evals](https://github.com/zeno-ml/zeno-evals),  | [Zeno](https://github.com/EleutherAI/lm-evaluation-harness/pull/990), [open_llm_leaderboard](https://huggingface.co/spaces/HuggingFaceH4/open_llm_leaderboard?ref=axion.zone) | [SeqIO](https://github.com/google/BIG-bench/blob/main/bigbench/bbseqio/README.md) | [helm-frontend](https://github.com/stanford-crfm/helm/tree/main/src/helm-frontend) |
+-------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------+------------------------------------------------------------------------------------+